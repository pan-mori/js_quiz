<!DOCTYPE html>
<html lang="cs">
  <head>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital@1&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
    <meta charset="UTF-8" />
    <title>Quiz</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
  </head>
  <body>
    <article>
      <div id="question-container"></div>
      <button id="evaluate">Vyhodnotit</button>
    </article>

    <script>
      var questionsData;
      getJson();

      async function getJson() {
        try {
          const response = await fetch("data.json");
          const data = await response.json();
          questionsData = data;
          displayQuestions(questionsData);
        } catch (error) {
          console.error("Chyba při načítání dat:", error);
        }
      }

      const correctAnswerId = "answer2";

      function displayQuestions(questionsData) {
        const questionContainer = document.getElementById("question-container");
        questionsData.questions.forEach((question, questionIndex) => {
          const questionElement = document.createElement("div");
          questionElement.classList.add("question");
          questionElement.innerHTML = `<h1>${question.header}</h1>`;
          questionElement.innerHTML += `<p>${question.text}</p>`;
          questionElement.innerHTML += `<h3>${question.answer_headers}</h3>`;

          questionContainer.appendChild(questionElement);

          question.answer.forEach((answer, answerIndex) => {
            const answerLabel = document.createElement("label");
            answerLabel.className = "answer";
            var answer_index_add = answerIndex + 1;
            answerLabel.innerHTML = `
                        <input type="radio" name="question${questionIndex}" value="${answer_index_add}">
                        ${answer}
                    `;
            questionElement.appendChild(answerLabel);
          });
        });
      }

      function evaluateAnswers() {
        const correctAnswers = questionsData.questions.map(
          (question) => question.correct
        );

        questionsData.questions.forEach((question, questionIndex) => {
          const radioButtons = document.getElementsByName(
            `question${questionIndex}`
          );
          const selectedRadioButton = getSelectedRadioButton(radioButtons);

          if (selectedRadioButton !== null) {
            const selectedAnswerIndex = parseInt(selectedRadioButton.value);
            if (selectedAnswerIndex === correctAnswers[questionIndex]) {
              selectedRadioButton.parentNode.classList.add("correct");
            }
          }
        });
      }
      function getSelectedRadioButton(radioButtons) {
        for (let i = 0; i < radioButtons.length; i++) {
          if (radioButtons[i].checked) {
            return radioButtons[i];
          }
        }
        return null;
      }

      document
        .getElementById("evaluate")
        .addEventListener("click", evaluateAnswers);

      document
        .getElementById("evaluate")
        .addEventListener("click", function () {
          const radioButtons = document.getElementsByName("answer");
          for (let i = 0; i < radioButtons.length; i++) {
            if (radioButtons[i].checked) {
              const selectedAnswer = radioButtons[i].parentNode;
              if (radioButtons[i].value === correctAnswerId) {
                selectedAnswer.classList.add("good");
              }
              if (radioButtons[i].value != correctAnswerId) {
                selectedAnswer.classList.add("bad");
                correctAnswerId.classList.add("good");
              }
            }
          }
        });
    </script>
  </body>
</html>
